REQUIRE NUMBER? ~mak/lib/fpcnum.f

: DLL_CREATE CREATE  PARSE-NAME FILE-BUFF ASCII-Z DLL_S
 DUP 0= ABORT" api unavailable" , ;

\ parameters in reverse order

: XAPI_0: DLL_CREATE DOES> @ XAPI_0 ;
: XAPI_1: DLL_CREATE DOES> @ XAPI_1 NIP ;
: XAPI_2: DLL_CREATE DOES> @ XAPI_2 NIP NIP ;
: XAPI_3: DLL_CREATE DOES> @ XAPI_3 NIP NIP NIP ;
: XAPI_4: DLL_CREATE DOES> @ XAPI_4 NIP NIP NIP NIP ;
: XAPI_5: DLL_CREATE DOES> @ XAPI_5 NIP NIP NIP NIP NIP ;
: XAPI_9: DLL_CREATE DOES> @ XAPI_9 NIP NIP NIP NIP NIP  NIP NIP NIP NIP ;

: XAPI0: >IN @  POSTPONE [DEFINED]  IF DROP POSTPONE \ BREAK >IN ! XAPI_0:  ;
: XAPI1: >IN @  POSTPONE [DEFINED]  IF DROP POSTPONE \ BREAK >IN ! XAPI_1:  ;
: XAPI2: >IN @  POSTPONE [DEFINED]  IF DROP POSTPONE \ BREAK >IN ! XAPI_2:  ;
: XAPI3: >IN @  POSTPONE [DEFINED]  IF DROP POSTPONE \ BREAK >IN ! XAPI_3:  ;
: XAPI4: >IN @  POSTPONE [DEFINED]  IF DROP POSTPONE \ BREAK >IN ! XAPI_4:  ;
: XAPI5: >IN @  POSTPONE [DEFINED]  IF DROP POSTPONE \ BREAK >IN ! XAPI_5:  ;
\ : XAPI6: >IN @  POSTPONE [DEFINED]  IF DROP POSTPONE \ BREAK >IN ! XAPI_6:  ;
\ : XAPI12: >IN @  POSTPONE [DEFINED]  IF DROP POSTPONE \ BREAK >IN ! XAPI_12:  ;

\ parameters sequence is correspond to documentation

: WAPI_0: DLL_CREATE DOES> @ NXCALL0 ;
: WAPI_1: DLL_CREATE DOES> @ NXCALL1 ;
: WAPI_2: DLL_CREATE DOES> @ NXCALL2 ;
: WAPI_3: DLL_CREATE DOES> @ NXCALL3 ;
: WAPI_4: DLL_CREATE DOES> @ NXCALL4 ;
: WAPI_5: DLL_CREATE DOES> @ 5 NXCALL ;
: WAPI_6: DLL_CREATE DOES> @ 6 NXCALL ;
: WAPI_10: DLL_CREATE DOES> @ 10 NXCALL ;
: WAPI_12: DLL_CREATE DOES> @ 12 NXCALL ;


: WAPI0: >IN @  POSTPONE [DEFINED]  IF 2DROP POSTPONE \ BREAK >IN ! WAPI_0:  ;
: WAPI1: >IN @  POSTPONE [DEFINED]  IF 2DROP POSTPONE \ BREAK >IN ! WAPI_1:  ;
: WAPI2: >IN @  POSTPONE [DEFINED]  IF 2DROP POSTPONE \ BREAK >IN ! WAPI_2:  ;
: WAPI3: >IN @  POSTPONE [DEFINED]  IF 2DROP POSTPONE \ BREAK >IN ! WAPI_3:  ;
: WAPI4: >IN @  POSTPONE [DEFINED]  IF 2DROP POSTPONE \ BREAK >IN ! WAPI_4:  ;
: WAPI5: >IN @  POSTPONE [DEFINED]  IF 2DROP POSTPONE \ BREAK >IN ! WAPI_5:  ;
: WAPI6: >IN @  POSTPONE [DEFINED]  IF 2DROP POSTPONE \ BREAK >IN ! WAPI_6:  ;
: WAPI10: >IN @  POSTPONE [DEFINED]  IF 2DROP POSTPONE \ BREAK >IN ! WAPI_10:  ;
: WAPI12: >IN @  POSTPONE [DEFINED]  IF 2DROP POSTPONE \ BREAK >IN ! WAPI_12:  ;

CR .( LIB LOAD=)  S" KERNEL32.DLL" DROP DLL_L DUP H.
DUP 0= [IF] .( KERNEL32.DLL LOAD ERROR) ABORT [THEN]
 CONSTANT KERNEL32DLL

: WNDPROC: ( xt "name" -- )
 PARSE-WORD SHEADER

 $53 C,		\ push ebx
 $56 C,		\ push esi
 $57 C,		\ push edi
 $41 C, $55  C,	\ push r13
 $41 C, $56  C,	\ push r14
 $55 C,		\ push ebp

 $48 C, $81 C, $EC C,  $3000 L, \    subq    $0x18000,%rsp  

 POSTPONE TASKININ1
 POSTPONE PARAM

 COMPILE,

  $48 C, $81 C, $C4 C,  $3000 L, \ addq    $0x18000,%rsp  

    $5D C,     \ pop  ebp 
    $41 C, $5E C, \ pop r14
    $41 C, $5D C, \ pop r13   
    $5F C,     \ pop  edi 
    $5E C,     \ pop  esi 
    $5B C,    \ pop  ebx 
 POSTPONE EXIT
;

: WNDPROC1: ( xt "name" -- )

 PARSE-WORD SHEADER

 $53 C,		\ push ebx
 $56 C,		\ push esi
 $57 C,		\ push edi
 $41 C, $55  C,	\ push r13
 $41 C, $56  C,	\ push r14
 $55 C,		\ push ebp

 $48 C, $81 C, $EC C,  $3000 L, \    subq    $0x18000,%rsp  

 POSTPONE TASKININ1
 POSTPONE PARAM

 COMPILE,

  $48 C, $81 C, $C4 C,  $3000 L, \ addq    $0x18000,%rsp  

    $5D C,     \ pop  ebp 
    $41 C, $5E C, \ pop r14
    $41 C, $5D C, \ pop r13   
    $5F C,     \ pop  edi 
    $5E C,     \ pop  esi 
    $5B C,    \ pop  ebx 
 POSTPONE EXIT
;

